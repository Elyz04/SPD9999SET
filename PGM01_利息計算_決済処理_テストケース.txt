000000*****************************************************************
000000* テストケース仕様書（PGM001 利息計算・決済処理用）【改訂版】
000000*---------------------------------------------------------------*
000000* プログラムID : PGM001
000000*---------------------------------------------------------------*
000000* プログラム概要
000000* 本テストケースは、銀行ABCの預金管理システムにおける
000000* PGM001プログラムの以下処理の正当性を検証する。
000000*
000000*   ・FUNCTION-001：利息計算処理（プレビュー専用）
000000*   ・FUNCTION-002：満期決済および口座残高更新処理
000000*
000000* 本プログラムは、JCL から渡されるパラメータにより
000000* 実行対象の機能を制御する。
000000*---------------------------------------------------------------*
000000* テスト目的
000000*---------------------------------------------------------------*
000000* 1. FUNCTION-001 において、利息および合計金額が
000000*    正しく計算されることを確認する（DB更新なし）
000000* 2. FUNCTION-002 において、満期判定および
000000*    決済処理（DB更新）が正しく行われることを確認する
000000* 3. SQLエラー発生時に ABEND 処理および
000000*    ROLLBACK が正しく行われることを確認する
000000*---------------------------------------------------------------*
000000* 前提条件
000000*---------------------------------------------------------------*
000000* - DB_ACCOUNT_SAVINGS テーブルが存在すること
000000* - DB_ACCOUNT_BALANCE テーブルが存在すること
000000* - 利率は DB_INTEREST_INFO テーブルから取得されること
000000* - 対象データは STATUS = '1' のレコードのみとする
000000* - 処理はカーソルにより 1 レコード単位で実行される
000000*---------------------------------------------------------------*
000000* パラメータ仕様（JCL）
000000*---------------------------------------------------------------*
000000* PARM = '1' : FUNCTION-001（利息計算プレビューのみ、DB更新なし）
000000* PARM = '2' : FUNCTION-002（満期決済・DB更新あり）
000000* PARM = '3' : FUNCTION-001 → FUNCTION-002 を順に実行
000000* 上記以外 : 異常終了（STOP RUN）
000000*---------------------------------------------------------------*
000000* 1. 正常系テストケース（Normal Case）
000000*---------------------------------------------------------------*
000000* ケース1 : FUNCTION-001 非定期預金の利息計算（プレビュー）
000000*---------------------------------------------------------------*
000000* 条件
000000*   - PARM = '1'
000000*   - DB_ACCOUNT_SAVINGS.STATUS = '1'
000000*   - SAVING_TYPE = 'NON-TERM'
000000*
000000* 処理内容
000000*   - 現在日付（または JCL 指定日付）を取得する
000000*   - START_DATE から現在日付までの実経過日数を算出する
000000*   - DB_INTEREST_INFO から利率を取得する
000000*   - 以下の式で利息を計算する
000000*
000000*     利息 = MONEY_ROOT × 利率 × 経過日数 ÷ 365
000000*
000000*   - 合計金額を算出する
000000*
000000*     TOTAL = MONEY_ROOT + INTEREST
000000*
000000* 期待結果
000000*   - 利息および合計金額が正しく計算されること
000000*   - DB_ACCOUNT_SAVINGS は更新されないこと
000000*---------------------------------------------------------------*
000000* ケース2 : FUNCTION-001 定期預金の利息計算（満期未考慮・プレビュー）
000000*---------------------------------------------------------------*
000000* 条件
000000*   - PARM = '1'
000000*   - SAVING_TYPE = FIXED（03 / 06 / 12）
000000*
000000* 処理内容
000000*   - 満期判定は行わない
000000*   - START_DATE から現在日付までの実経過日数を使用する
000000*   - 利息計算式は非定期預金と同一とする
000000*
000000* 期待結果
000000*   - 利息および合計金額が正しく計算されること
000000*   - DB更新が行われないこと
000000*---------------------------------------------------------------*
000000* ケース3 : FUNCTION-002 満期決済処理
000000*---------------------------------------------------------------*
000000* 条件
000000*   - PARM = '2'
000000*   - DB_ACCOUNT_SAVINGS.STATUS = '1'
000000*
000000* 処理内容
000000*   - 対象データを取得する
000000*   - 満期日判定を行う
000000*   - 利息を計算する
000000*     ・満期時：定期利率
000000*     ・未満期：非定期利率
000000*   - 以下の DB 更新を行う
000000*     ・DB_ACCOUNT_BALANCE.BALANCE 更新
000000*     ・DB_ACCOUNT_SAVINGS.STATUS = '9'
000000*
000000* 期待結果
000000*   - 口座残高が更新されること
000000*   - 預金ステータスが決済済に更新されること
000000*---------------------------------------------------------------*
000000* ケース4 : PARM = '3' の場合
000000*---------------------------------------------------------------*
000000* 条件
000000*   - PARM = '3'
000000*
000000* 処理内容
000000*   - FUNCTION-001 を実行（プレビュー）
000000*   - 続けて FUNCTION-002 を実行（決済）
000000*
000000* 期待結果
000000*   - 利息計算後、決済処理が行われること
000000*---------------------------------------------------------------*
000000* 2. 異常系テストケース（Abnormal Case）
000000*---------------------------------------------------------------*
000000* ケースA : SQLエラー発生
000000*---------------------------------------------------------------*
000000* 条件
000000*   - SELECT / FETCH / UPDATE 実行時に SQLCODE ≠ 0
000000*
000000* 期待結果
000000*   - CST-ABEND-BREAKPOINT に処理名が設定される
000000*   - ROLLBACK が実行される
000000*   - エラーメッセージ出力後、STOP RUN される
000000*---------------------------------------------------------------*
000000* ケースB : 日付不正（START_DATE > 現在日付）
000000*---------------------------------------------------------------*
000000* 条件
000000*   - START_DATE が現在日付より未来
000000*
000000* 処理内容
000000*   - 経過日数が負となるため 0 に補正される
000000*
000000* 期待結果
000000*   - 利息 = 0
000000*   - 処理は継続される
000000*---------------------------------------------------------------*
000000* ケースC : 無効パラメータ
000000*---------------------------------------------------------------*
000000* 条件
000000*   - PARM が '1','2','3' 以外
000000*
000000* 期待結果
000000*   - INVALID PARAM メッセージが出力される
000000*   - STOP RUN される
000000*---------------------------------------------------------------*
000000* 備考
000000*---------------------------------------------------------------*
000000* - 利息計算はすべて DB_INTEREST_INFO の利率を使用する
000000* - FUNCTION-001 は表示目的のみで DB更新は行わない
000000* - 満期判定および DB更新は FUNCTION-002 のみで行う
000000*****************************************************************
