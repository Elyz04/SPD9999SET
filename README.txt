000000*****************************************************************
000000* 業務仕様説明（最新版・ソースコード準拠・改訂版）
000000*---------------------------------------------------------------*
000000* プログラムID : PGM001
000000*---------------------------------------------------------------*
000000* プログラム概要
000000*---------------------------------------------------------------*
000000* 本プログラムは、銀行ABCの預金管理システムにおいて、
000000* 有効な預金契約（STATUS='1'）を対象に、
000000* 利息計算処理（FUNCTION-001）および
000000* 満期・前倒し精算処理（FUNCTION-002）を行う
000000* COBOL バッチプログラムである。
000000*
000000* FUNCTION-001 は利息計算のプレビュー処理であり、
000000* DB の更新は行わない。
000000*
000000* FUNCTION-002 においてのみ、
000000* 精算処理および DB 更新を行う。
000000*
000000* JCL パラメータにより、実行する処理を制御する。
000000*
000000*   PARAM = '1' : FUNCTION-001 のみ実行（DB更新なし）
000000*   PARAM = '2' : FUNCTION-002 のみ実行（DB更新あり）
000000*   PARAM = '3' : FUNCTION-001 → FUNCTION-002 を順次実行
000000*---------------------------------------------------------------*
000000* 対象テーブル
000000*---------------------------------------------------------------*
000000* DB_ACCOUNT_SAVINGS（預金契約情報）
000000*   - ORDER_ID
000000*   - ACC_ID
000000*   - SAVING_TYPE
000000*   - START_DATE
000000*   - END_DATE
000000*   - MONEY_ROOT
000000*   - INTEREST
000000*   - MONEY
000000*   - STATUS
000000*
000000* DB_INTEREST_INFO（利率マスタ）
000000*   - SAVING_TYPE
000000*   - INTEREST_RATE
000000*
000000* DB_ACCOUNT_BALANCE（口座残高）
000000*   - ACC_ID
000000*   - BALANCE
000000*---------------------------------------------------------------*
000000* 処理フロー概要
000000*---------------------------------------------------------------*
000000* 1. 初期処理
000000*   - JCL パラメータ（PARAM）をチェック
000000*   - '1','2','3' 以外の場合はエラーメッセージ出力後、
000000*     異常終了（STOP RUN）
000000*
000000* 2. 指定された処理を実行
000000*   - FUNCTION-001（利息計算プレビュー）
000000*   - FUNCTION-002（精算処理）
000000*
000000* 3. 正常終了時
000000*   - COMMIT を 1 回のみ実行
000000*---------------------------------------------------------------*
000000* FUNCTION-001：利息計算処理（プレビュー専用）
000000*---------------------------------------------------------------*
000000* 【処理概要】
000000* DB_ACCOUNT_SAVINGS.STATUS = '1' の契約を対象に、
000000* 現在日時点での仮利息および合計金額を計算する。
000000*
000000* 本処理では、以下を行わない。
000000*   ・満期判定
000000*   ・END_DATE の参照
000000*   ・DB 更新
000000*
000000* 【処理詳細】
000000* 1. 対象データ取得
000000*   - STATUS = '1' の契約をカーソルで取得
000000*
000000* 2. 現在日付取得
000000*   - FUNCTION CURRENT-DATE を使用
000000*   - START_DATE との差分日数を算出
000000*   - 経過日数 < 0 の場合は 0 に補正
000000*
000000* 3. 利率取得
000000*   - DB_INTEREST_INFO から
000000*     SAVING_TYPE に対応する利率を取得
000000*
000000* 4. 利息計算（単利）
000000*   - 預金種別に関わらず以下の式を使用
000000*
000000*     利息 = MONEY_ROOT × 利率 × 経過日数 ÷ 365
000000*
000000* 5. 合計金額算出
000000*   - TOTAL = MONEY_ROOT + INTEREST
000000*
000000* ※ FUNCTION-001 では
000000*    DB_ACCOUNT_SAVINGS は一切更新しない
000000*---------------------------------------------------------------*
000000* FUNCTION-002：精算処理
000000*---------------------------------------------------------------*
000000* 【処理概要】
000000* DB_ACCOUNT_SAVINGS.STATUS = '1' の契約を対象に、
000000* 満期到達または前倒し解約を判定し、
000000* 精算処理および DB 更新を行う。
000000*
000000* 【処理詳細】
000000* 1. 対象データ取得
000000*   - STATUS = '1' の契約をカーソルで取得
000000*
000000* 2. 日付判定
000000*   - 現在日付、START_DATE、END_DATE を比較
000000*
000000* 3. 利息再計算
000000*
000000* 【非定期預金（NON-TERM）】
000000*   - 利息 = MONEY_ROOT × 非定期利率 × 経過日数 ÷ 365
000000*
000000* 【定期預金（FIXED-03 / FIXED-06 / FIXED-12）】
000000*
000000*   満期到達（現在日付 >= END_DATE）
000000*     - 契約日数を固定値で使用
000000*       FIXED-03 : 90 日
000000*       FIXED-06 : 180 日
000000*       FIXED-12 : 365 日
000000*
000000*     利息 = MONEY_ROOT × 定期利率 × 契約日数 ÷ 365
000000*
000000*   前倒し解約（現在日付 < END_DATE）
000000*     - 非定期利率を取得
000000*
000000*     利息 = MONEY_ROOT × 非定期利率 × 経過日数 ÷ 365
000000*
000000* 4. 合計金額算出
000000*   - MONEY = MONEY_ROOT + INTEREST
000000*
000000* 5. 口座残高更新
000000*   - DB_ACCOUNT_BALANCE.BALANCE に
000000*     MONEY を加算更新
000000*
000000* 6. 契約ステータス更新
000000*   - DB_ACCOUNT_SAVINGS.STATUS = '9'
000000*
000000* ※ FUNCTION-002 では
000000*    DB_ACCOUNT_SAVINGS.INTEREST / MONEY は更新しない
000000*---------------------------------------------------------------*
000000* エラー処理
000000*---------------------------------------------------------------*
000000* - SQLCODE < 0 の場合
000000*    ・エラー発生箇所を CST-ABEND-BREAKPOINT に設定
000000*    ・エラーログ出力
000000*    ・ROLLBACK 実行
000000*    ・異常終了（STOP RUN）
000000*---------------------------------------------------------------*
000000* 注意事項
000000*---------------------------------------------------------------*
000000* - すべての契約は 1 件ずつ処理する
000000* - 利率は必ず DB から取得する（ハードコード禁止）
000000* - 利息計算は単利計算とする
000000* - COMMIT はメイン処理終了時に 1 回のみ実行
000000*****************************************************************
